/*!
	photobox v1.2
	(c) 2012 Yair Even Or <http://dropthebit.com>

	based (~12%) on Picbox v2.2 from:
	(c) 2010 Ben Kay <http://bunnyfire.co.uk>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(a,m){function Q(b){b.preventDefault();n.removeClass("active");n=a(this).parent().addClass("active");b=a.inArray(this,a(b.delegateTarget).data("a"));return D(b,0,1)}function I(b){b&&(d.src=J);a(d).css({transition:"0s"}).removeAttr("style");a(e).show().addClass("show");a(e).on("click","img",function(a){a.stopPropagation()});a(e).on(r,function(){a(d).addClass("zoomable");a(e).off(r).addClass("on")});y&&a(e).trigger("MSTransitionEnd");j.hideFlash&&a.each(["object","embed"],function(c,f){a(f).each(function(){b&& (this._picbox=this.style.visibility);this.style.visibility=b?"hidden":this._picbox})});a(m)[b?"on":"off"]({"keydown.photobox":R,"mousewheel.photobox":S});j.thumbs&&(n.removeAttr("class"),a(T).on("resize.photobox",K),K())}function K(){E=g[0].clientWidth;F=g[0].firstChild.clientWidth;g[F>E?"on":"off"]("mousemove",U)}function U(a){g[0].scrollLeft=a.pageX*(F/E)-500}function R(a){a=a.keyCode;var c=j.keys;return 0<=c.close.indexOf(a)&&G()||0<=c.next.indexOf(a)&&z("next")||0<=c.prev.indexOf(a)&&z("prev")|| !0}function z(b){if(a(pbOverlay).hasClass("hide"))return!1;b="pbPrevBtn"==this.id||"prev"==b?s:t;var c="both"==g.css("clear");return D(b,0,c)}function D(b,c,f){0<=b&&(u=b,A=k[b][0],s=(u||(j.loop?k.length:0))-1,t=(u+1)%k.length||(j.loop?0:-1),L(),a(e).addClass("pbLoading").removeClass("error"),!j.loop&&b==k.length-1?B.addClass("hide"):B.removeClass("hide"),!j.loop&&0==b?C.addClass("hide"):C.removeClass("hide"),j.thumbs&&(n.removeClass("active"),n=g.find("li").eq(b).addClass("active"),f||(f=n[0].offsetLeft+ n[0].clientWidth/2-l.clientWidth/2,c&&g.delay(800),!c&&g.stop(),g.animate({scrollLeft:f},500,"swing"))),0<=s&&(M.src=k[s][0]),0<=t&&(N.src=k[t][0]),j.counter&&v.find(".counter").text("( "+(u+1)+" / "+k.length+" )"),j.title&&v.find(".title").text(k[b][1]),a(d).siblings().hide(),p=new Image,p.onload=function(){var b=function(){a(d).css({transition:"0s"}).attr("class","prepare").hide().off(r);a(e).removeClass("hide");d.src=A;setTimeout(function(){a(d).removeAttr("style");setTimeout(function(){d.className= ""},0)},0)};c?b():(a(d).on(r,b),a(e).addClass("hide"),y&&b());a(e).removeClass("pbLoading")},p.onerror=function(){a(e).removeClass("pbLoading").addClass("error");d.src=J;p.onerror=null},p.src=A);return!1}function S(b,c){var f=a(d).data("zoom")||1,h=d.getBoundingClientRect(),f=f+c/10;0.1>f&&(f=0.1);a(d).data("zoom",f).css({transform:"scale("+f+")"});if(h.height>l.clientHeight||h.width>l.clientWidth)a(m).on("mousemove.photobox",V);else a(m).off("mousemove.photobox"),d.style[w]="50% 50%";return!1}function V(a){d.style[w]= 100*(a.clientX/l.clientWidth)+"% "+100*((a.clientY/l.clientHeight*(l.clientHeight+200)-100)/l.clientHeight)+"%"}function L(){p.onload=function(){};p.src=M.src=N.src=A}function G(){function b(){a(e).removeClass("show hide on");a(d).removeAttr("class").removeAttr("src").removeAttr("style").off().data("zoom",1);jQuery.browser.msie&&setTimeout(function(){a(e).hide()},200)}L();u=s=t=-1;a(document).off("mousemove");I();a(e).addClass("hide");a(d).on(r,b);y&&b();setTimeout(b,500);return!1}function H(b){var c= b||window.event,f=[].slice.call(arguments,1),h=0,d=0,e=0;b=a.event.fix(c);b.type="mousewheel";c.wheelDelta&&(h=c.wheelDelta/120);c.detail&&(h=-c.detail/3);e=h;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(e=0,d=-1*h);void 0!==c.wheelDeltaY&&(e=c.wheelDeltaY/120);void 0!==c.wheelDeltaX&&(d=-1*c.wheelDeltaX/120);f.unshift(b,h,d,e);return(a.event.dispatch||a.event.handle).apply(this,f)}var T=a(window),j,k=[],g,x,u=-1,A,s,t,l,r="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",y=jQuery.browser.msie&& 10>a.browser.version,w,E,F,n=a(),J="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",p={},M=new Image,N=new Image,e,d,C,B,v,O={loop:!0,thumbs:!0,counter:!0,title:!0,hideFlash:!0,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}};a(m).ready(function(){a(m.body).prepend(a([e=a('<div id="pbOverlay">').hide().on("click",G).append(a('<div class="pbLoader"><b></b><b></b><b></b></div>'),C=a('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",z),B=a('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click", z),imageWrap=a('<div class="imageWrap">').append(d=a("<img>")[0])[0],a('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",G)[0],v=a('<div id="pbCaption">').append('<div class="title">').append('<div class="counter">'))[0]]));a:{var b="transformOrigin",c,f=m.body.style,h=["ms","O","Moz","Webkit"];if(""==f[b])w=b;else{b=b[0].toUpperCase()+b.slice(1);for(c=h.length;c--;)if(""==f[h[c]+b]){w=h[c]+b;break a}w=void 0}}});a.photobox=function(b,c){j=a.extend(O,c||{});y&&a(e).addClass("msie");I(1); 2>k.length&&v.find(".counter").remove();return D(b,!0)};a.fn.photobox=function(b){x=this;x=x.filter(function(){var a=this.firstElementChild;if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;k.push([this.href,a.getAttribute("alt")||a.getAttribute("title")]);return!0});if(O.thumbs||b.thumbs){var c=x;g=a("<div>").addClass("pbThumbs");var d=a("<ul>").appendTo(g);g.appendTo(v);c.each(function(){a("<li>").append(a(this).clone()).appendTo(d)});a(e).addClass("thumbs");g.on("click","a",Q).data("a", g.find("a"))}a(this.context).on("click",this.selector,function(c){c.preventDefault();2>k.length&&C.add(B).remove();l=m.documentElement;return a.photobox(a.inArray(this,x),b)});return this};var q=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var P=q.length;P;)a.event.fixHooks[q[--P]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=q.length;a;)this.addEventListener(q[--a],H,!1);else this.onmousewheel=H},teardown:function(){if(this.removeEventListener)for(var a= q.length;a;)this.removeEventListener(q[--a],H,!1);else this.onmousewheel=null}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery,document);